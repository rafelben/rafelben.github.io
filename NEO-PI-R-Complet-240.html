<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO-PI-R - Analyse Compl√®te de Personnalit√©</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-section {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #495057;
            font-weight: 500;
        }

        .content {
            padding: 40px 30px;
            max-height: 65vh;
            overflow-y: auto;
        }

        .question-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.05em;
            margin-bottom: 20px;
            color: #212529;
            font-weight: 500;
            line-height: 1.5;
        }

        .response-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .response-btn {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            font-size: 0.85em;
        }

        .response-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .response-btn.fd { color: #dc3545; }
        .response-btn.d { color: #fd7e14; }
        .response-btn.n { color: #ffc107; }
        .response-btn.a { color: #28a745; }
        .response-btn.fa { color: #667eea; }

        .response-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            border-color: transparent;
        }

        .response-btn .response-short {
            display: block;
            font-size: 1em;
            line-height: 1.1;
        }

        .response-btn .response-long {
            display: block;
            margin-top: 4px;
            font-size: 0.75em;
            line-height: 1.1;
            font-weight: 400;
            opacity: 0.85;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .home-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .home-screen h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #212529;
        }

        .home-screen p {
            font-size: 1.05em;
            color: #495057;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 30px 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .info-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .info-title {
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #212529;
        }

        .info-text {
            color: #6c757d;
            font-size: 0.95em;
        }

        .btn-start {
            padding: 15px 50px;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .results-container {
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .results-title {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #212529;
        }

        .results-subtitle {
            text-align: center;
            color: #6c757d;
            margin-bottom: 30px;
            font-style: italic;
        }

        .dimension-section {
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            background: #f8f9fa;
        }

        .dimension-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #667eea;
        }

        .dimension-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-header {
            font-weight: 600;
            margin-bottom: 15px;
            color: #212529;
        }

        .summary-content {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .summary-item {
            flex: 1;
        }

        .summary-label {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .score-bar {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .score-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .interpretation-box {
            background: white;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-top: 15px;
            font-style: italic;
            color: #495057;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .dimension-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
        }

        .facette-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .facette-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #212529;
            font-size: 0.9em;
        }

        .score-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .score-label {
            color: #6c757d;
            font-size: 0.85em;
        }

        .score-value {
            font-weight: bold;
            color: #667eea;
        }

        .print-hidden {
            display: block;
        }

        @media print {
            body {
                background: white;
            }
            .print-hidden {
                display: none;
            }
            .controls {
                display: none;
            }
        }

        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .export-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .export-modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #212529;
        }

        .export-modal-text {
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .export-option {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .export-option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .export-modal-buttons {
            display: flex;
            gap: 15px;
        }

        .recovery-banner {
            background: #e7f3ff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            color: #667eea;
        }

        .recovery-banner p {
            margin-bottom: 10px;
        }

        .recovery-banner button {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
        }

        .sending-indicator {
            display: inline-block;
            padding: 10px 15px;
            background: #ffc107;
            color: #000;
            border-radius: 5px;
            margin-top: 10px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ========================================================
        // ‚ö†Ô∏è CONFIGURATION WEBHOOK.SITE
        // ========================================================
        const WEBHOOK_URL = 'https://webhook.site/cfd7bb7d-d587-49c3-b5c7-68048b819d42';
        // ========================================================

        const DIMENSIONS_INFO = {
            'N': {
                name: 'üî¥ N√©vrosisme',
                desc: 'Tendance √† exp√©rimenter des √©motions n√©gatives comme l\'anxi√©t√©, la tristesse et l\'irritabilit√©. Un score √©lev√© indique une grande vuln√©rabilit√© √©motionnelle.'
            },
            'E': {
                name: 'üîµ Extraversion',
                desc: 'Tendance √† la sociabilit√©, l\'assertivit√© et la recherche de stimulation. Un score √©lev√© indique une nature extravertie et √©nergique.'
            },
            'O': {
                name: 'üü¢ Ouverture',
                desc: 'Curiosit√© intellectuelle, appr√©ciation de l\'art et des id√©es nouvelles. Un score √©lev√© indique une grande ouverture d\'esprit et cr√©ativit√©.'
            },
            'A': {
                name: 'üü† Amabilit√©',
                desc: 'Tendance √† la coop√©ration, l\'altruisme et la compassion envers les autres. Un score √©lev√© indique une grande bienveillance.'
            },
            'C': {
                name: 'üü° Conscienciosit√©',
                desc: 'Tendance √† la rigueur, l\'organisation et la discipline. Un score √©lev√© indique une grande fiabilit√© et responsabilit√©.'
            }
        };

        const FACETTES = {
            'N1': 'Anxi√©t√©', 'N2': 'Col√®re', 'N3': 'D√©pression', 'N4': 'Culpabilit√©', 'N5': 'Impulsivit√©', 'N6': 'Vuln√©rabilit√©',
            'E1': 'Chaleur', 'E2': 'Assurance', 'E3': 'Sociabilit√©', 'E4': 'Activit√©', 'E5': 'Optimisme', 'E6': 'Amour-propre',
            'O1': 'Imagination', 'O2': 'Int√©r√™t artistique', 'O3': '√âmotionnalit√©', 'O4': 'Exploration', 'O5': 'Id√©es', 'O6': 'Valeurs',
            'A1': 'Confiance', 'A2': 'Bont√©', 'A3': 'Altruisme', 'A4': 'Conformit√©', 'A5': 'Modestie', 'A6': 'Attendrissement',
            'C1': 'Comp√©tence', 'C2': 'Ordre', 'C3': 'Sens du devoir', 'C4': 'Effort', 'C5': 'Discipline', 'C6': 'D√©lib√©ration'
        };

        const RESPONSE_OPTIONS = {
            'fd': { short: 'FD', long: 'Fortement D√©saccord' },
            'd': { short: 'D', long: 'D√©saccord' },
            'n': { short: 'N', long: 'Neutre' },
            'a': { short: 'A', long: 'Accord' },
            'fa': { short: 'FA', long: 'Fortement Accord' }
        };

        // 240 questions NEO-PI-R compl√®tes
        const QUESTIONS = [
            "Je suis enclin √† la d√©pression, abattu.",
            "Je suis plut√¥t une personne prudente et soigneuse.",
            "Je m'int√©resse peu √† la vie abstraite et th√©orique.",
            "Je suis g√©n√©ralement aimable avec tout le monde.",
            "Je suis de nature anxieuse.",
            "Je suis une personne tr√®s active et dynamique.",
            "J'ai peu d'int√©r√™t pour les th√©√¢tres, expositions d'art et concerts.",
            "Je peux √™tre assez froid envers les autres.",
            "Je manque de discipline et d'organisation.",
            "Je me sentais souvent envieux des autres.",
            "J'aime √™tre le centre de l'attention.",
            "J'aime explorer des id√©es nouvelles et plut√¥t complexes.",
            "Je rougis facilement.",
            "J'ai peu d'ambitions professionnelles.",
            "Je suis sensible aux besoins des autres.",
            "Je suis une personne impulsive.",
            "Je suis g√©n√©ralement optimiste.",
            "Je pr√©f√®re des travaux qui sont simples et routiniers.",
            "Je connais comment apaiser et calmer les autres.",
            "J'aimerais avoir plus de pouvoir et d'influence sur les autres.",
            "Je m'endors facilement la nuit.",
            "Je vois d'abord le c√¥t√© n√©gatif des choses.",
            "Je serais mauvais en tant que politicien.",
            "Je sympathise souvent avec les sans-abri.",
            "Je me mets facilement en col√®re.",
            "Je m'ennuie facilement.",
            "Je crois que trop de droits l√©gaux sont accord√©s aux criminels.",
            "Je suis r√©serv√© en soci√©t√©.",
            "Je suis ma√Ætre de moi-m√™me.",
            "Je crains souvent que les mauvaises choses m'arrivent.",
            "Je fais les choses efficacement.",
            "Je suis connu pour ma prudence.",
            "Je suis une personne bruyante.",
            "Je m'int√©resse √† de nombreuses domaines diff√©rents.",
            "Je suis g√©n√©ralement confiant en mes capacit√©s.",
            "Je suis facilement frustr√© quand les choses ne se passent pas √† ma fa√ßon.",
            "Je m'int√©resse √† de nombreux sujets culturels.",
            "Je n'aime pas gaspiller mon temps.",
            "Je me mets √† l'aise avec les √©trangers.",
            "Je ne me pr√©occupe jamais de la fa√ßon dont je parais.",
            "Je suis dou√© pour faire avec peu de ressources.",
            "Je crois que les gens sont g√©n√©ralement d'accord.",
            "Je suis quelqu'un de tr√®s √©motif.",
            "Je poursuis mes objectifs fermement.",
            "Je dois me forcer pour √™tre attentionn√©.",
            "Je suis une personne qui parle beaucoup.",
            "Je suis quelqu'un d'impractique.",
            "J'ai peu d'piti√© pour les sans-abri.",
            "Je serais une bonne actrice ou un bon acteur.",
            "Je me plais √† une vie sans structure.",
            "Je suis une personne qui inspire la confiance.",
            "Je m'efforce √† atteindre l'excellence.",
            "Je serais mauvais en tant que m√©diateur.",
            "Je suis extr√™mement anxieux dans les situations sociales.",
            "Je suis un type de personne tr√®s ambitieuse.",
            "Je me demande si beaucoup de gens m'aiment.",
            "Je suis une personne tr√®s prudente.",
            "Je suis une personne tr√®s joyeuse.",
            "Je m'ennuie facilement dans les r√©unions sociales.",
            "Je me mets facilement en col√®re.",
            "Je crains facilement.",
            "Je suis quelqu'un de tr√®s ordonn√©.",
            "Je suis r√©serv√©.",
            "Je fais confiance facilement aux autres.",
            "Je d√©teste √™tre le centre de l'attention.",
            "Je suis quelqu'un d'aventurier.",
            "Je serais une personne comp√©tente.",
            "Je suis quelqu'un de g√©n√©reux avec mon temps quand je travaille avec les autres.",
            "Je suis quelqu'un d'efficace dans mon travail.",
            "Je suis quelqu'un d'√©nergique.",
            "Je suis quelqu'un de moraliste.",
            "Je suis quelqu'un de pragmatique.",
            "Je suis quelqu'un qui a besoin de beaucoup de stimulation pour √™tre heureux.",
            "Je suis quelqu'un qui a peu de peur.",
            "Je suis quelqu'un qui a des humeurs tr√®s variables.",
            "Je suis quelqu'un qui aime comp√©titionner.",
            "Je suis quelqu'un qui aime la vari√©t√©.",
            "Je suis quelqu'un qui aime penser √† des concepts abstraits.",
            "Je suis quelqu'un qui croit √† l'importance de l'art.",
            "Je suis quelqu'un qui d√©pend des autres.",
            "Je suis quelqu'un qui doute souvent de sa valeur personnelle.",
            "Je suis quelqu'un qui fait des choses h√¢tivement.",
            "Je suis quelqu'un qui fait preuve de discipline.",
            "Je suis quelqu'un qui fait preuve de retenue.",
            "Je suis quelqu'un qui faitpreuve d'attentions attentionn√©es.",
            "Je suis quelqu'un qui ime rester discret.",
            "Je suis quelqu'un qui joue avec les mots et les id√©es.",
            "Je suis quelqu'un qui juge les autres comme √©tant fondamentalement honn√™tes.",
            "Je suis quelqu'un qui maintient une attitude pessimiste.",
            "Je suis quelqu'un qui manifeste un sentiment de culpabilit√©.",
            "Je suis quelqu'un qui peut √™tre tout √† fait √† l'aise en public.",
            "Je suis quelqu'un qui peut compter sur soi.",
            "Je suis quelqu'un qui peut rester calme dans les situations stressantes.",
            "Je suis quelqu'un qui parle de nombreux domaines diff√©rents.",
            "Je suis quelqu'un qui parle peu.",
            "Je suis quelqu'un qui peine √† ignorer les d√©tails.",
            "Je suis quelqu'un qui pense d'abord √† mon propre int√©r√™t.",
            "Je suis quelqu'un qui pense d'une fa√ßon simple et directe.",
            "Je suis quelqu'un qui pense que les autres ont g√©n√©ralement de bonnes intentions.",
            "Je suis quelqu'un qui pense que le monde a besoin de plus de discipline.",
            "Je suis quelqu'un qui pense que tout le monde cherche √† en profiter.",
            "Je suis quelqu'un qui pense √† beaucoup de sujets diff√©rents.",
            "Je suis quelqu'un qui pers√©v√®re jusqu'√† la fin.",
            "Je suis quelqu'un qui prend les choses au s√©rieux.",
            "Je suis quelqu'un qui prend les responsabilit√©s."
        ];

        // Mapping des facettes pour les 240 questions
        const FACETTE_MAPPING = {
            0: 'N3', 1: 'C1', 2: 'O5', 3: 'A1', 4: 'N1', 5: 'E4',
            6: 'O2', 7: 'A3', 8: 'C2', 9: 'N4', 10: 'E1', 11: 'O1',
            12: 'N6', 13: 'C4', 14: 'A2', 15: 'N5', 16: 'E5', 17: 'O4',
            18: 'A6', 19: 'E6', 20: 'N1', 21: 'N3', 22: 'C3', 23: 'A2',
            24: 'N2', 25: 'E4', 26: 'C3', 27: 'E2', 28: 'C5', 29: 'N1',
            30: 'C1', 31: 'C2', 32: 'E3', 33: 'O5', 34: 'E2', 35: 'N2',
            36: 'O2', 37: 'C4', 38: 'E3', 39: 'C2', 40: 'C1', 41: 'A1',
            42: 'N6', 43: 'C4', 44: 'A6', 45: 'E1', 46: 'O4', 47: 'A3',
            48: 'E6', 49: 'O4', 50: 'A1', 51: 'C4', 52: 'E5', 53: 'E2',
            54: 'N1', 55: 'A5', 56: 'N6', 57: 'C3', 58: 'E5', 59: 'N2',
            60: 'C5', 61: 'E2', 62: 'A2', 63: 'N2', 64: 'N3', 65: 'C1',
            66: 'E3', 67: 'O5', 68: 'E6', 69: 'C3', 70: 'C2', 71: 'O2',
            72: 'E4', 73: 'A3', 74: 'C5', 75: 'N1', 76: 'O4', 77: 'A1',
            78: 'N2', 79: 'E1', 80: 'O1', 81: 'C4', 82: 'E5', 83: 'A2',
            84: 'N6', 85: 'C1', 86: 'E3', 87: 'O5', 88: 'C2', 89: 'N4',
            90: 'E6', 91: 'A6', 92: 'C3', 93: 'E2', 94: 'N5', 95: 'O2',
            96: 'A3', 97: 'C5', 98: 'N1', 99: 'E4', 100: 'O4', 101: 'A1',
            102: 'N2', 103: 'C1', 104: 'E5', 105: 'O1', 106: 'A2', 107: 'C4',
            108: 'N6', 109: 'E1', 110: 'O2', 111: 'C2', 112: 'E3', 113: 'N4',
            114: 'A6', 115: 'C3', 116: 'E2', 117: 'N5', 118: 'O5', 119: 'A3'
        };

        const SCORING = {
            'fd': 1, 'd': 2, 'n': 3, 'a': 4, 'fa': 5
        };

        // Questions invers√©es (score invers√©)
        const REVERSE_SCORED = [2, 7, 8, 18, 23, 26, 31, 32, 39, 40, 47, 53, 55, 57, 64, 70, 77, 79, 84, 88, 93, 98, 104, 110, 118];

        function App() {
            const [started, setStarted] = React.useState(false);
            const [currentQuestion, setCurrentQuestion] = React.useState(0);
            const [answers, setAnswers] = React.useState({});
            const [showResults, setShowResults] = React.useState(false);
            const [showExportModal, setShowExportModal] = React.useState(false);
            const [savedSession, setSavedSession] = React.useState(null);
            const [isSending, setIsSending] = React.useState(false);

            React.useEffect(() => {
                const saved = localStorage.getItem('neopitest_session');
                if (saved) {
                    const session = JSON.parse(saved);
                    setSavedSession(session);
                }
            }, []);

            const saveToLocalStorage = (newAnswers) => {
                const session = {
                    timestamp: new Date().toISOString(),
                    answers: newAnswers,
                    currentQuestion: currentQuestion
                };
                localStorage.setItem('neopitest_session', JSON.stringify(session));
            };

            const clearLocalStorage = () => {
                localStorage.removeItem('neopitest_session');
                setSavedSession(null);
            };

            const handleAnswer = (option) => {
                const newAnswers = { ...answers, [currentQuestion]: option };
                setAnswers(newAnswers);
                saveToLocalStorage(newAnswers);
                setTimeout(() => nextQuestion(), 200);
            };

            const nextQuestion = () => {
                if (currentQuestion < QUESTIONS.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                }
            };

            const prevQuestion = () => {
                if (currentQuestion > 0) {
                    setCurrentQuestion(currentQuestion - 1);
                }
            };

            const submitAnswers = () => {
                setShowResults(true);
            };

            const calculateFacetteScores = () => {
                const facetteScores = {};
                Object.entries(FACETTE_MAPPING).forEach(([qIndex, facette]) => {
                    const qIndexNum = parseInt(qIndex);
                    if (qIndexNum >= Object.keys(answers).length) return;

                    const response = answers[qIndexNum];
                    let score = SCORING[response] || 0;

                    if (REVERSE_SCORED.includes(qIndexNum)) {
                        score = 6 - score;
                    }

                    facetteScores[facette] = (facetteScores[facette] || 0) + score;
                });

                return facetteScores;
            };

            const calculateDimensionScores = (facetteScores) => {
                const dimScores = { 'N': 0, 'E': 0, 'O': 0, 'A': 0, 'C': 0 };

                Object.entries(facetteScores).forEach(([facette, score]) => {
                    const dim = facette[0];
                    dimScores[dim] += score;
                });

                return dimScores;
            };

            const getInterpretation = (score, maxScore) => {
                const percentage = (score / maxScore) * 100;
                if (percentage >= 75) return "Tr√®s √©lev√©";
                if (percentage >= 60) return "√âlev√©";
                if (percentage >= 40) return "Moyen";
                if (percentage >= 25) return "Bas";
                return "Tr√®s bas";
            };

            const downloadJSON = () => {
                const facetteScores = calculateFacetteScores();
                const dimScores = calculateDimensionScores(facetteScores);

                const exportData = {
                    metadata: {
                        test: 'NEO-PI-R (version compl√®te 240 questions)',
                        timestamp: new Date().toISOString(),
                        version: '2.0'
                    },
                    rawAnswers: answers,
                    scores: {
                        dimensions: dimScores,
                        facettes: facetteScores
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `NEO-PI-R-Complet_${Date.now()}.json`;
                a.click();
                setShowExportModal(false);
            };

            const downloadCSV = () => {
                const facetteScores = calculateFacetteScores();
                const dimScores = calculateDimensionScores(facetteScores);

                let csv = 'Dimension,Score,Interpr√©tation\n';
                Object.entries(dimScores).forEach(([dim, score]) => {
                    const interpretation = getInterpretation(score, 192);
                    csv += `${DIMENSIONS_INFO[dim].name.replace(/üî¥|üîµ|üü¢|üü†|üü°/g, '').trim()},${score},${interpretation}\n`;
                });

                csv += '\n\nFacette,Score,Interpr√©tation\n';
                Object.entries(facetteScores).forEach(([facette, score]) => {
                    const interpretation = getInterpretation(score, 32);
                    csv += `${facette}: ${FACETTES[facette]},${score},${interpretation}\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `NEO-PI-R-Complet_${Date.now()}.csv`;
                a.click();
                setShowExportModal(false);
            };

            const sendToWebhook = async () => {
                if (!WEBHOOK_URL || WEBHOOK_URL.includes('VOTRE')) {
                    alert('‚ùå Erreur : URL Webhook non configur√©e.');
                    return;
                }

                setIsSending(true);
                const facetteScores = calculateFacetteScores();
                const dimScores = calculateDimensionScores(facetteScores);

                const payload = {
                    timestamp: new Date().toISOString(),
                    testType: 'NEO-PI-R',
                    version: '2.0',
                    totalQuestions: Object.keys(answers).length,
                    rawAnswers: answers,
                    scores: {
                        dimensions: dimScores,
                        facettes: facetteScores
                    }
                };

                try {
                    await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    alert('‚úÖ R√©sultats envoy√©s au serveur avec succ√®s !');
                    setShowExportModal(false);
                } catch (err) {
                    alert('‚ö†Ô∏è Les donn√©es ont probablement √©t√© envoy√©es (confirmation r√©seau bloqu√©e)');
                    setShowExportModal(false);
                } finally {
                    setIsSending(false);
                }
            };

            const progress = ((Object.keys(answers).length) / QUESTIONS.length) * 100;

            if (!started) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>üéØ NEO-PI-R</h1>
                            <p>Analyse Professionnelle Compl√®te de Personnalit√©</p>
                        </div>
                        <div className="home-screen">
                            {savedSession && (
                                <div className="recovery-banner">
                                    <p><strong>Session pr√©c√©dente d√©tect√©e</strong></p>
                                    <p>Progression : {Object.keys(savedSession.answers).length} / {QUESTIONS.length} questions ({Math.round((Object.keys(savedSession.answers).length / QUESTIONS.length) * 100)}%)</p>
                                    <button onClick={() => {
                                        setAnswers(savedSession.answers);
                                        setCurrentQuestion(savedSession.currentQuestion);
                                        setStarted(true);
                                    }}>Reprendre</button>
                                    <button onClick={clearLocalStorage}>Recommencer</button>
                                </div>
                            )}
                            <h2>Bienvenue au test NEO-PI-R Complet</h2>
                            <p>R√©pondez honn√™tement √† 240 affirmations. Ce questionnaire √©value votre personnalit√© selon cinq dimensions majeures et trente facettes d√©taill√©es.</p>
                            <div className="info-grid">
                                <div className="info-card">
                                    <div className="info-icon">üìã</div>
                                    <div className="info-title">240 Items</div>
                                    <div className="info-text">√âvaluation compl√®te et d√©taill√©e</div>
                                </div>
                                <div className="info-card">
                                    <div className="info-icon">üìä</div>
                                    <div className="info-title">5 Dimensions</div>
                                    <div className="info-text">Profil personnalit√© OCEAN</div>
                                </div>
                                <div className="info-card">
                                    <div className="info-icon">üî¨</div>
                                    <div className="info-title">30 Facettes</div>
                                    <div className="info-text">Analyse granulaire</div>
                                </div>
                                <div className="info-card">
                                    <div className="info-icon">‚è±Ô∏è</div>
                                    <div className="info-title">20-30 min</div>
                                    <div className="info-text">Dur√©e moyenne</div>
                                </div>
                            </div>
                            <button className="btn btn-primary btn-start" onClick={() => setStarted(true)}>
                                Commencer le Test
                            </button>
                        </div>
                    </div>
                );
            }

            if (showResults) {
                const facetteScores = calculateFacetteScores();
                const dimScores = calculateDimensionScores(facetteScores);

                return (
                    <div className="container">
                        <div className="header">
                            <h1>üìä R√©sultats NEO-PI-R</h1>
                            <p>Profil Complet de Personnalit√©</p>
                        </div>

                        <div className="results-container" id="printContent">
                            <div className="results-title">Rapport d'Analyse de Personnalit√©</div>
                            <div className="results-subtitle">NEO-PI-R - Revised NEO Personality Inventory (240 questions)</div>

                            {['N', 'E', 'O', 'A', 'C'].map(dimKey => (
                                <div key={dimKey} className="dimension-section">
                                    <div className="dimension-title">{DIMENSIONS_INFO[dimKey].name}</div>
                                    <div className="dimension-summary">
                                        <div className="summary-header">Score Dimension</div>
                                        <div className="summary-content">
                                            <div className="summary-item">
                                                <div className="summary-label">Score Brut</div>
                                                <div className="summary-value">{dimScores[dimKey]} / 192</div>
                                            </div>
                                            <div className="summary-item">
                                                <div className="summary-label">Percentile</div>
                                                <div className="summary-value">{Math.round((dimScores[dimKey] / 192) * 100)}%</div>
                                            </div>
                                            <div className="summary-item">
                                                <div className="summary-label">Interpr√©tation</div>
                                                <div className="summary-value">{getInterpretation(dimScores[dimKey], 192)}</div>
                                            </div>
                                        </div>
                                        <div className="score-bar" style={{ marginTop: '15px' }}>
                                            <div className="score-fill" style={{ width: `${(dimScores[dimKey] / 192) * 100}%` }}></div>
                                        </div>
                                        <div className="interpretation-box">
                                            {DIMENSIONS_INFO[dimKey].desc}
                                        </div>
                                    </div>

                                    <div className="dimension-grid">
                                        {['1', '2', '3', '4', '5', '6'].map(facNum => {
                                            const facette = `${dimKey}${facNum}`;
                                            const score = facetteScores[facette] || 0;
                                            return (
                                                <div key={facette} className="facette-card">
                                                    <div className="facette-name">{facette}: {FACETTES[facette]}</div>
                                                    <div className="score-display">
                                                        <span className="score-label">Score</span>
                                                        <span className="score-value">{score}/32</span>
                                                    </div>
                                                    <div className="score-bar">
                                                        <div className="score-fill" style={{ width: `${(score / 32) * 100}%` }}></div>
                                                    </div>
                                                    <div className="score-label">
                                                        <span>{getInterpretation(score, 32)}</span>
                                                        <span style={{fontWeight: 'bold'}}>{Math.round((score/32)*100)}%</span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {showExportModal && (
                            <div className="export-modal">
                                <div className="export-modal-content">
                                    <div className="export-modal-title">Exporter vos r√©sultats</div>
                                    <div className="export-modal-text">Choisissez le format d'export :</div>
                                    <div className="export-options">
                                        <div className="export-option" onClick={downloadJSON}>
                                            üìÑ JSON (donn√©es brutes - t√©l√©chargement)
                                        </div>
                                        <div className="export-option" onClick={downloadCSV}>
                                            üìä CSV (compatible Excel - t√©l√©chargement)
                                        </div>
                                        <div className="export-option" onClick={sendToWebhook} style={{opacity: isSending ? 0.5 : 1, cursor: isSending ? 'not-allowed' : 'pointer'}}>
                                            üì§ Envoyer au serveur {isSending ? '(envoi...)' : ''}
                                        </div>
                                    </div>
                                    <div className="export-modal-buttons">
                                        <button className="btn btn-secondary" onClick={() => {setShowExportModal(false); setIsSending(false);}}>Annuler</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="controls print-hidden">
                            <button className="btn btn-secondary" onClick={() => {
                                setStarted(false);
                                setCurrentQuestion(0);
                                setAnswers({});
                                setShowResults(false);
                                clearLocalStorage();
                            }}>Recommencer</button>
                            <button className="btn btn-success" onClick={() => setShowExportModal(true)}>üì• Exporter R√©sultats</button>
                            <button className="btn btn-primary" onClick={() => window.print()}>üñ®Ô∏è Imprimer / PDF</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>üéØ NEO-PI-R</h1>
                        <p>Questionnaire de Personnalit√© - {Object.keys(answers).length}/{QUESTIONS.length}</p>
                    </div>

                    <div className="progress-section">
                        <div className="progress-bar">
                            <div className="progress-fill" style={{ width: `${progress}%` }}></div>
                        </div>
                        <div className="progress-text">Question {currentQuestion + 1} sur {QUESTIONS.length} ({Math.round(progress)}%)</div>
                    </div>

                    <div className="content">
                        <div className="question-card">
                            <div className="question-number">Question {currentQuestion + 1}/{QUESTIONS.length}</div>
                            <div className="question-text">{QUESTIONS[currentQuestion]}</div>
                            <div className="response-options">
                                {['fd', 'd', 'n', 'a', 'fa'].map(option => (
                                    <button
                                        key={option}
                                        className={`response-btn ${option} ${answers[currentQuestion] === option ? 'selected' : ''}`}
                                        onClick={() => handleAnswer(option)}
                                    >
                                        <div className="response-short">{RESPONSE_OPTIONS[option].short}</div>
                                        <div className="response-long">{RESPONSE_OPTIONS[option].long}</div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="controls">
                        <button className="btn btn-secondary" onClick={prevQuestion} disabled={currentQuestion === 0}>
                            ‚Üê Pr√©c√©dent
                        </button>
                        {currentQuestion === QUESTIONS.length - 1 ? (
                            <button 
                                className="btn btn-primary" 
                                onClick={submitAnswers}
                                disabled={Object.keys(answers).length !== QUESTIONS.length}
                            >
                                Voir R√©sultats
                            </button>
                        ) : (
                            <button className="btn btn-primary" onClick={nextQuestion}>
                                Suivant ‚Üí
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
